<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>AutoPlan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- FullCalendar -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css">

  <style>
    body{
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#f5f6f8; margin:0; padding:20px; color:#222;
    }
    .container{
      max-width:1100px; margin:auto; background:#fff; padding:20px;
      border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,0.08);
    }

    h1{ margin:0 0 6px 0; }
    p{ margin:0 0 14px 0; color:#444; }

    .topbar{
      display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px;
      margin-bottom:10px;
    }
    .pill{
      background:#f3f4f6; border-radius:999px; padding:6px 10px;
      font-size:13px; display:flex; gap:6px; align-items:center;
    }
    .dot{ width:10px; height:10px; border-radius:50%; }
    .dom{ background:#2563eb; }
    .pri{ background:#16a34a; }

    .cars{
      display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:10px; margin-bottom:14px;
    }
    .car{
      border:none; border-radius:8px; padding:10px;
      background:#2563eb; color:#fff; font-weight:700; cursor:pointer;
    }
    .car.active{ outline:3px solid rgba(37,99,235,.4); }

    .viewToggle{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:14px; }
    .btn{
      border:none; border-radius:8px; padding:8px 12px;
      background:#e5e7eb; cursor:pointer; font-weight:600;
    }
    .btn.primary{ background:#16a34a; color:#fff; }
    .btn.danger{ background:#dc2626; color:#fff; }
    .btn.active{ outline:3px solid rgba(0,0,0,.15); }

    .layout{
      display:grid; gap:16px;
      grid-template-columns: 360px minmax(0,1fr);
    }
    @media (max-width: 900px){
      .layout{ grid-template-columns:1fr; }
    }

    .card{
      border:1px solid #eee; border-radius:10px;
      padding:14px; background:#fff;
    }

    form{ display:grid; gap:10px; }
    label{ font-size:14px; }
    input,select{
      width:100%; padding:10px; border:1px solid #ccc;
      border-radius:8px; font-size:14px;
    }

    .row2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (min-width: 901px){
      .row2{ grid-template-columns:1fr; }
    }

    .msg{ font-size:14px; margin-top:6px; }
    .msg.ok{ color:#15803d; }
    .msg.err{ color:#b91c1c; }

    .list{ display:grid; gap:10px; }
    .item{
      border:1px solid #eee; border-radius:10px;
      padding:12px; cursor:pointer;
    }
    .item:hover{ background:#f9fafb; }

    #calendarWrap{ display:none; }

    /* FullCalendar tweaks */
    .fc .fc-toolbar-title{
      font-size:1rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    @media (max-width:600px){
      .fc .fc-toolbar-title{ font-size:.85rem; }
      .fc .fc-button{ font-size:.85rem; padding:.3em .45em; }
      .fc .fc-col-header-cell-cushion{ font-size:.75rem; }
      .fc .fc-daygrid-day-number{ font-size:.75rem; }
    }

    /* Modal */
    .modalOverlay{
      position:fixed; inset:0; background:rgba(0,0,0,.45);
      display:none; align-items:center; justify-content:center;
    }
    .modal{
      background:#fff; border-radius:12px;
      padding:16px; width:min(500px,95%);
    }
    .modal .row{ display:flex; gap:10px; justify-content:flex-end; }
  </style>
</head>

<body>
<div class="container">
  <div class="topbar">
    <div>
      <h1>AutoPlan</h1>
      <p>Privatbuchungen erfassen – Domizil (blau) blockiert automatisch.</p>
    </div>
    <div class="pill">
      <span class="dot dom"></span> Domizil
      <span class="dot pri"></span> Privat
    </div>
  </div>

  <div class="cars">
    <button class="car active" data-car="ALL">Alle</button>
    <button class="car" data-car="Auto 1">Auto 1</button>
    <button class="car" data-car="Auto 2">Auto 2</button>
    <button class="car" data-car="Auto 3">Auto 3</button>
    <button class="car" data-car="Auto 4">Auto 4</button>
  </div>

  <div class="viewToggle">
    <button class="btn active" id="showList">Liste</button>
    <button class="btn" id="showWeek">Woche</button>
    <button class="btn" id="showMonth">Monat</button>
  </div>

  <div class="layout">
    <div class="card">
      <h2>Privat buchen</h2>
      <form id="bookingForm">
        <select id="car">
          <option>Auto 1</option><option>Auto 2</option>
          <option>Auto 3</option><option>Auto 4</option>
        </select>
        <input id="name" placeholder="Vorname" required>
        <div class="row2">
          <input id="start" type="datetime-local" required>
          <input id="end" type="datetime-local" required>
        </div>
        <button class="btn primary">Speichern</button>
      </form>
      <div id="msg" class="msg"></div>
    </div>

    <div class="card">
      <div id="listWrap">
        <h2>Buchungsübersicht</h2>
        <div id="bookings" class="list"></div>
      </div>
      <div id="calendarWrap">
        <div id="calendar"></div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modalOverlay" id="modal">
  <div class="modal">
    <h3 id="mTitle"></h3>
    <p id="mTime"></p>
    <div class="row">
      <button class="btn" onclick="closeModal()">Schliessen</button>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
  firebase.initializeApp({
    apiKey:"AIzaSyCVTH62pNLqZMh-8myCmQxjnXG_gvAPtB4",
    authDomain:"autoplan-6b642.firebaseapp.com",
    projectId:"autoplan-6b642"
  });
  const db = firebase.firestore();

  let bookings=[];

  function renderList(){
    const el=document.getElementById("bookings");
    el.innerHTML="";
    bookings.forEach(b=>{
      const d=document.createElement("div");
      d.className="item";
      d.style.borderLeft=`6px solid ${b.type==="domizil"?"#2563eb":"#16a34a"}`;
      d.innerHTML=`
        <strong>${b.car} – ${b.type==="domizil"?"Domizil":"Privat"}</strong>
        <div>${b.start.replace("T"," ")} → ${b.end.replace("T"," ")}</div>
        <div>${b.name||""}</div>`;
      d.onclick=()=>openModal(b);
      el.appendChild(d);
    });
  }

  function openModal(b){
    document.getElementById("mTitle").textContent =
      `${b.car} – ${b.type==="domizil"?"Domizil":"Privat"}`;
    document.getElementById("mTime").textContent =
      `${b.start.replace("T"," ")} → ${b.end.replace("T"," ")}`;
    document.getElementById("modal").style.display="flex";
  }
  function closeModal(){
    document.getElementById("modal").style.display="none";
  }

  db.collection("bookings").onSnapshot(s=>{
    bookings=s.docs.map(d=>d.data());
    renderList();
  });
</script>
</body>
</html>
